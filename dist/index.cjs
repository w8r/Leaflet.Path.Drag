"use strict";const a=require("leaflet");a.SVG.include({_resetTransformPath:function(t){t._path.setAttributeNS(null,"transform","")},transformPath:function(t,i){t._path.setAttributeNS(null,"transform","matrix("+i.join(" ")+")")}});a.SVG.include(a.Browser.vml?{_resetTransformPath:function(t){t._skew&&(t._skew.on=!1,t._path.removeChild(t._skew),t._skew=null)},transformPath:function(t,i){let n=t._skew;n||(n=a.SVG.create("skew"),t._path.appendChild(n),n.style.behavior="url(#default#VML)",t._skew=n);const s=i[0].toFixed(8)+" "+i[1].toFixed(8)+" "+i[2].toFixed(8)+" "+i[3].toFixed(8)+" 0 0",h=Math.floor(i[4]).toFixed()+", "+Math.floor(i[5]).toFixed(),o=this._path.style;let r=parseFloat(o.left),e=parseFloat(o.top),_=parseFloat(o.width),p=parseFloat(o.height);isNaN(r)&&(r=0),isNaN(e)&&(e=0),(isNaN(_)||!_)&&(_=1),(isNaN(p)||!p)&&(p=1);const l=(-r/_-.5).toFixed(8)+" "+(-e/p-.5).toFixed(8);n.on="f",n.matrix=s,n.origin=l,n.offset=h,n.on=!0}}:{});function P(){return!0}a.Canvas.include({_resetTransformPath:function(t){this._containerCopy&&(delete this._containerCopy,t._containsPoint_&&(t._containsPoint=t._containsPoint_,delete t._containsPoint_,this._requestRedraw(t)))},transformPath:function(t,i){let n=this._containerCopy;const s=this._ctx;let h;const o=a.Browser.retina?2:1,r=this._bounds,e=r.getSize(),_=r.min;n||(n=this._containerCopy=document.createElement("canvas"),h=n.getContext("2d"),n.width=o*e.x,n.height=o*e.y,this._removePath(t),this._redraw(),h.translate(o*r.min.x,o*r.min.y),h.drawImage(this._container,0,0),this._initPath(t),t._containsPoint_=t._containsPoint,t._containsPoint=P),s.save(),s.clearRect(_.x,_.y,e.x*o,e.y*o),s.setTransform(1,0,0,1,0,0),s.restore(),s.save(),s.drawImage(this._containerCopy,0,0,e.x,e.y),s.transform.apply(s,i),this._drawing=!0,t._updatePath(),this._drawing=!1,s.restore()}});/**
 * Leaflet vector features drag functionality
 * @author Alexander Milevski <info@w8r.name>
 * @preserve
 */a.Path.include({_transform:function(t){return this._renderer&&(t?this._renderer.transformPath(this,t):(this._renderer._resetTransformPath(this),this._update())),this},_onMouseClick:function(t){this.dragging&&this.dragging.moved()||this._map.dragging&&this._map.dragging.moved()||this._fireMouseEvent(t)}});const D={mousedown:"mouseup",touchstart:"touchend",pointerdown:"touchend",MSPointerDown:"touchend"},v={mousedown:"mousemove",touchstart:"touchmove",pointerdown:"touchmove",MSPointerDown:"touchmove"};function x(t,i){const n=t.x-i.x,s=t.y-i.y;return Math.sqrt(n*n+s*s)}a.Handler.PathDrag=a.Handler.extend({statics:{DRAGGING_CLS:"leaflet-path-draggable"},initialize:function(t){this._path=t,this._matrix=null,this._startPoint=null,this._dragStartPoint=null,this._mapDraggingWasEnabled=!1,this._path._dragMoved=!1},addHooks:function(){this._path.on("mousedown",this._onDragStart,this),this._path.options.className=this._path.options.className?this._path.options.className+" "+a.Handler.PathDrag.DRAGGING_CLS:a.Handler.PathDrag.DRAGGING_CLS,this._path._path&&a.DomUtil.addClass(this._path._path,a.Handler.PathDrag.DRAGGING_CLS)},removeHooks:function(){this._path.off("mousedown",this._onDragStart,this),this._path.options.className=this._path.options.className.replace(new RegExp("\\s+"+a.Handler.PathDrag.DRAGGING_CLS),""),this._path._path&&a.DomUtil.removeClass(this._path._path,a.Handler.PathDrag.DRAGGING_CLS)},moved:function(){return this._path._dragMoved},_onDragStart:function(t){const i=t.originalEvent._simulated?"touchstart":t.originalEvent.type;console.log({eventType:i}),this._mapDraggingWasEnabled=!1,this._startPoint=t.containerPoint.clone(),this._dragStartPoint=t.containerPoint.clone(),this._matrix=[1,0,0,1,0,0],a.DomEvent.stop(t.originalEvent),a.DomUtil.addClass(this._path._renderer._container,"leaflet-interactive"),a.DomEvent.on(document,v[i],this._onDrag,this).on(document,D[i],this._onDragEnd,this),this._path._map.dragging.enabled()&&(this._path._map.dragging.disable(),this._mapDraggingWasEnabled=!0),this._path._dragMoved=!1,this._path._popup&&this._path._popup.close(),this._replaceCoordGetters(t)},_onDrag:function(t){a.DomEvent.stop(t);const i=t.touches&&t.touches.length>=1?t.touches[0]:t,n=this._path._map.mouseEventToContainerPoint(i);if(t.type==="touchmove"&&!this._path._dragMoved&&this._dragStartPoint.distanceTo(n)<=this._path._map.options.tapTolerance)return;const s=n.x,h=n.y,o=s-this._startPoint.x,r=h-this._startPoint.y;(o||r)&&(this._path._dragMoved||(this._path._dragMoved=!0,this._path.options.interactive=!1,this._path._map.dragging._draggable._moved=!0,this._path.fire("dragstart",t),this._path.bringToFront()),this._matrix[4]+=o,this._matrix[5]+=r,this._startPoint.x=s,this._startPoint.y=h,this._path.fire("predrag",t),this._path._transform(this._matrix),this._path.fire("drag",t))},_onDragEnd:function(t){const i=this._path._map.mouseEventToContainerPoint(t),n=this.moved();if(n&&(this._transformPoints(this._matrix),this._path._updatePath(),this._path._project(),this._path._transform(null),a.DomEvent.stop(t)),a.DomEvent.off(document,"mousemove touchmove",this._onDrag,this),a.DomEvent.off(document,"mouseup touchend",this._onDragEnd,this),this._restoreCoordGetters(),n){this._path.fire("dragend",{distance:x(this._dragStartPoint,i)});const s=this._path._containsPoint;this._path._containsPoint=a.Util.falseFn,a.Util.requestAnimFrame(function(){this._path._dragMoved=!1,this._path.options.interactive=!0,this._path._containsPoint=s},this)}this._mapDraggingWasEnabled&&this._path._map.dragging.enable()},_transformPoints:function(t,i){const n=this._path,s=L.point(t[4],t[5]),h=n._map.options.crs,o=h.transformation,r=h.scale(n._map.getZoom()),e=h.projection,_=o.untransform(s,r).subtract(o.untransform(a.point(0,0),r)),p=!i;if(n._bounds=new a.LatLngBounds,n._point)i=e.unproject(e.project(n._latlng)._add(_)),p&&(n._latlng=i,n._point._add(s));else if(n._rings||n._parts){const l=n._rings||n._parts;let c=n._latlngs;i=i||c,a.Util.isArray(c[0])||(c=[c],i=[i]);for(let g=0,f=l.length;g<f;g++){i[g]=i[g]||[];for(let d=0,u=l[g].length;d<u;d++){const m=c[g][d];i[g][d]=e.unproject(e.project(m)._add(_)),p&&(n._bounds.extend(c[g][d]),l[g][d]._add(s))}}}return i},_replaceCoordGetters:function(){this._path.getLatLng?(this._path.getLatLng_=this._path.getLatLng,this._path.getLatLng=a.Util.bind(function(){return this.dragging._transformPoints(this.dragging._matrix,{})},this._path)):this._path.getLatLngs&&(this._path.getLatLngs_=this._path.getLatLngs,this._path.getLatLngs=a.Util.bind(function(){return this.dragging._transformPoints(this.dragging._matrix,[])},this._path))},_restoreCoordGetters:function(){this._path.getLatLng_?(this._path.getLatLng=this._path.getLatLng_,delete this._path.getLatLng_):this._path.getLatLngs_&&(this._path.getLatLngs=this._path.getLatLngs_,delete this._path.getLatLngs_)}});a.Handler.PathDrag.makeDraggable=function(t){return t.dragging=new a.Handler.PathDrag(t),t};a.Path.prototype.makeDraggable=function(){return a.Handler.PathDrag.makeDraggable(this)};a.Path.addInitHook(function(){this.options.draggable?(this.options.interactive=!0,this.dragging?this.dragging.enable():(a.Handler.PathDrag.makeDraggable(this),this.dragging.enable())):this.dragging&&this.dragging.disable()});const w=a.Handler.PathDrag;module.exports=w;
